var string="";var msg="";var owned="";var vorId="";var attType="";sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,i){"use strict";return e.extend("Workshop.zfleet_workshop.controller.View1",{onInit:function(){var e={Descision:[{DescisionKey:"1",DescisionText:"Yes"},{DescisionKey:"2",DescisionText:"No"}]};var i=new t(e);this.getView().setModel(i,"drpDown");var s={Descision:[{DescisionKey:"1",DescisionText:"Excellent"},{DescisionKey:"2",DescisionText:"good"},{DescisionKey:"3",DescisionText:"damaged"}]};var a=new t(s);this.getView().setModel(a,"drpDown2");var r=window.location.href;var d=r.split("ccc");if(d.length===2){string=d[1];this.zrecord=string.substr(1,10);vorId=this.zrecord}var b=this;var l=b.getOwnerComponent().getModel();var V="/notificationSubmitSet('"+this.zrecord+"')";l.read(V,{success:function(e,t){var i=new sap.ui.model.json.JSONModel(e);var s=b.getView().byId("mainForm1");s.setModel(i);if(e.onsite_team==="Yes"){b.getView().byId("Rescue").setSelectedKey(1)}else if(e.onsite_team==="No"){b.getView().byId("Rescue").setSelectedKey(2)}if(e.teamvisit_date!=="00000000"){b.getView().byId("Date1").setVisible(true);b.getView().byId("DP1").setVisible(true);b.getView().byId("DP1").setValue(e.teamvisit_date)}if(e.teamvisit_time!==""){b.getView().byId("Time1").setVisible(true);b.getView().byId("TP1").setVisible(true);b.getView().byId("TP1").setValue(e.teamvisit_time)}if(e.fixed_at_loc==="Yes"){b.getView().byId("fixed").setSelectedKey(1);b.getView().byId("fixedtext").setVisible(true);b.getView().byId("fixed").setVisible(true)}else if(e.fixed_at_loc==="No"){b.getView().byId("fixed").setSelectedKey(2);b.getView().byId("fixedtext").setVisible(true);b.getView().byId("fixed").setVisible(true)}if(e.repair==="Yes"){b.getView().byId("Repair").setSelectedKey(1);b.getView().byId("Repairtext").setVisible(true);b.getView().byId("Repair").setVisible(true)}else if(e.repair==="No"){b.getView().byId("Repair").setSelectedKey(2);b.getView().byId("Repairtext").setVisible(true);b.getView().byId("Repair").setVisible(true)}if(e.repair_date!=="00000000"){b.getView().byId("Date2").setVisible(true);b.getView().byId("DP2").setVisible(true);b.getView().byId("DP2").setValue(e.repair_date)}if(e.repair_time!==""){b.getView().byId("Time2").setVisible(true);b.getView().byId("TP2").setVisible(true);b.getView().byId("TP2").setValue(e.repair_time)}if(e.tow_van==="Yes"){b.getView().byId("towvan").setSelectedKey(1);b.getView().byId("Towtext").setVisible(true);b.getView().byId("towvan").setVisible(true)}else if(e.tow_van==="No"){b.getView().byId("towvan").setSelectedKey(2);b.getView().byId("Towtext").setVisible(true);b.getView().byId("towvan").setVisible(true)}if(e.towvisit_date!=="00000000"){b.getView().byId("Date3").setVisible(true);b.getView().byId("DP3").setVisible(true);b.getView().byId("DP3").setValue(e.towvisit_date)}if(e.towvisit_time!==""){b.getView().byId("Time3").setVisible(true);b.getView().byId("TP3").setVisible(true);b.getView().byId("TP3").setValue(e.towvisit_time)}if(e.eqtyp==="O"){owned="X"}if(e.attachment1==="X"){b.getView().byId("L1").setVisible(true);b.getView().byId("onShowFront1").setVisible(true)}if(e.attachment2==="X"){b.getView().byId("L2").setVisible(true);b.getView().byId("onShowFront2").setVisible(true)}if(e.attachment3==="X"){b.getView().byId("L3").setVisible(true);b.getView().byId("onShowFront3").setVisible(true)}if(e.attachment4==="X"){b.getView().byId("L4").setVisible(true);b.getView().byId("onShowFront4").setVisible(true)}if(e.attachment5==="X"){b.getView().byId("L5").setVisible(true);b.getView().byId("onShowFront5").setVisible(true)}if(e.attachment6==="X"){b.getView().byId("L6").setVisible(true);b.getView().byId("onShowFront6").setVisible(true)}if(e.attachment7==="X"){b.getView().byId("textcore").setVisible(true);b.getView().byId("L7").setVisible(true);b.getView().byId("onShowFront7").setVisible(true)}if(e.attachment8==="X"){b.getView().byId("L8").setVisible(true);b.getView().byId("onShowFront8").setVisible(true)}if(e.attachment9==="X"){b.getView().byId("L9").setVisible(true);b.getView().byId("onShowFront9").setVisible(true)}if(e.attachment10==="X"){b.getView().byId("L10").setVisible(true);b.getView().byId("onShowFront10").setVisible(true)}},error:function(e,t){}})},showComment:function(){var e=this;var t=[];var i=this.getOwnerComponent().getModel();var s=new sap.ui.model.Filter("vor_id",sap.ui.model.FilterOperator.EQ,vorId);t.push(s);var a="/CommentSet";i.read(a,{filters:t,success:function(t,i){var s=new sap.ui.model.json.JSONModel;var a={Table:t.results};s.setData(a);e.getView().byId("IdClearanceType1").setVisible(true);e.getView().byId("id1").setModel(s,"Data")},error:function(){}})},onSaveRequest:function(){var e=this;var t=this.getOwnerComponent().getModel();var i=this.getView().byId("fixed")._getSelectedItemText();var s=this.getView().byId("Rescue")._getSelectedItemText();var a=this.getView().byId("DP1").getValue();var r=this.getView().byId("TP1").getValue();var d=this.getView().byId("towvan")._getSelectedItemText();var b=this.getView().byId("DP3").getValue();var l=this.getView().byId("TP3").getValue();var V=this.getView().byId("Repair")._getSelectedItemText();var o=this.getView().byId("DP2").getValue();var g=this.getView().byId("TP2").getValue();var n=this.getView().byId("idComment").getValue();var w=this.getView().byId("Jack")._getSelectedItemText();var I=this.getView().byId("JackHandle")._getSelectedItemText();var y=this.getView().byId("SpareTire")._getSelectedItemText();var h=this.getView().byId("Triangle")._getSelectedItemText();var f=this.getView().byId("WheelSpanner")._getSelectedItemText();var u=this.getView().byId("FireExtinguisher")._getSelectedItemText();var c=this.getView().byId("AirPipe")._getSelectedItemText();var m=this.getView().byId("Radio")._getSelectedItemText();var v=this.getView().byId("FuelCap")._getSelectedItemText();var T=this.getView().byId("AirScoop")._getSelectedItemText();var p=this.getView().byId("WindScreenScratch")._getSelectedItemText();var x=this.getView().byId("FrontTyre")._getSelectedItemText();var S=this.getView().byId("BackTyre")._getSelectedItemText();var _=this.getView().byId("LightCondition")._getSelectedItemText();var D=this.getView().byId("BodyScratch")._getSelectedItemText();var P=this.getView().byId("MirrorRearView")._getSelectedItemText();var F=this.getView().byId("Indecation")._getSelectedItemText();var C=this.getView().byId("TailLight")._getSelectedItemText();var R=this.getView().byId("SideLight")._getSelectedItemText();var k=this.getView().byId("NumberPlate")._getSelectedItemText();var M=this.getView().byId("ProtectionBars")._getSelectedItemText();var L=this.getView().byId("Istimarah")._getSelectedItemText();var X=this.getView().byId("FahsSticker")._getSelectedItemText();var A=this.getView().byId("MotCards")._getSelectedItemText();var B=this.getView().byId("BrandingQuality")._getSelectedItemText();var N={jack:w,jackhandle:I,sparetire:y,triangle:h,wheelspanner:f,fireextngr:u,airpipe:c,radio:m,fuelcap:v,airscoop:T,windscreenscratch:p,fronttype:x,backtyre:S,lightcondition:_,bodyscratch:D,mirrorrearview:P,indecation:F,taillight:C,sidelight:R,numberplate:k,protectionbars:M,istimarah:L,fahssticker:X,motcards:A,brandingquality:B,fixed_at_loc:i,onsite_team:s,teamvisit_date:a,teamvisit_time:r,tow_van:d,towvisit_date:b,towvisit_time:l,repair:V,repair_date:o,repair_time:g,vor_id:vorId,Comment:n};t.create("/WorkshopSet",N,{success:function(t){if(t.eMsg===""){msg="Claim ID  has been Saved"}else{msg=t.eMsg}e.getView().byId("Idsubmit").setVisible(false);sap.m.MessageBox.alert(msg,{onClose:function(e){}})},error:function(e){debugger;sap.m.MessageBox.alert("Error in submitting Claim  !",{onClose:function(e){}})}})},onShow:function(e){debugger;var t=e.getParameters();var i=t.id;var s=i.split("--");var a=s[2];var r="";if(a==="onShowFront1"){r="AT1"}if(a==="onShowFront2"){r="AT2"}if(a==="onShowFront3"){r="AT3"}if(a==="onShowFront4"){r="AT1"}if(a==="onShowFront5"){r="AT5"}if(a==="onShowFront6"){r="AT6"}if(a==="onShowFront7"){r="AT7"}if(a==="onShowFront8"){r="AT8"}if(a==="onShowFront9"){r="AT9"}if(a==="onShowFront10"){r="AT10"}if(r!==""){var d=this;var b=d.getOwnerComponent().getModel();var l="/attachmentsSet(zvor_id="+"'"+this.zrecord+"'"+",Ztype="+"'"+r+"'"+")";b.read(l,{success:function(e,t){var i=e.Content;var s=e.Filetype;var a=e.Filename;i="data:"+s+";base64,"+i;if(!d.displayContent){d.displayContent=sap.ui.xmlfragment("Workshop.zfleet_workshop.fragment.filepreview",d);d.getView().addDependent(d.displayContent)}var r=s.split("/");var b=r[0];var s=a.split(".");var l=s[1];switch(b){case"image":sap.ui.getCore().byId("idPdfViewer").setVisible(false);sap.ui.getCore().byId("image").setVisible(true);sap.ui.getCore().byId("image").setSrc(i);break;default:sap.ui.getCore().byId("idPdfViewer").setVisible(true);sap.ui.getCore().byId("image").setVisible(false);var V=sap.ui.getCore().byId("idPdfViewer");V.setContent('<iframe src="'+i+'" embedded="true" frameborder="0" target="_top" width="2000px" height="2000px"></iframe>');break}debugger;if(l!=="docx"&&l!=="pub"&&l!=="xls"&&l!=="ppt"&&l!=="doc"&&l!=="xlsx"){d.displayContent.open();d.fragOpen=true}if(d.fragOpen===undefined){window.open(i,"_self");i=i.replace("data:APPLICATION/WWI;base64,","")}},error:function(){sap.m.MessageToast.show("No Data retreived")}})}},onPressBarCloseBtn:function(e){this.displayContent.close();this.fragOpen=undefined},onSaveFront1:function(e){var t=" ";var i=e.getParameters();var s=i.id;var a=s.split("--");var r=a[2];var d="";if(r==="onSaveFront1"){attType="WT1";t=this.getView().byId("idfront1")}if(r==="onSaveFront2"){attType="WT2";t=this.getView().byId("idfront2")}if(r==="onSaveBack1"){attType="WT3";t=this.getView().byId("idback1")}if(r==="onSaveBack2"){attType="WT4";t=this.getView().byId("idback2")}if(r==="onSaveRight1"){attType="WT5";t=this.getView().byId("idRight1")}var b=this;var l=t.getFocusDomRef();if(l.files.length!==0){var V=l.files[0];b.filenameLicense=V.name;b.filetypeLicense=V.type;var o=new FileReader;o.onload=function(e){var t=e.currentTarget.result.replace("data:"+V.type+";base64,","");b.postFileToBackend(vorId,attType,b.filenameLicense,b.filetypeLicense,t)};o.readAsDataURL(V)}},postFileToBackend:function(e,t,i,s,a){var r={zvor_id:e,Ztype:t,Content:a,Filename:i,Filetype:s};var d=this.getView().getModel();d.create("/attachmentsSet",r,{success:function(e,t){msg="File Has been Uploaded!!";sap.m.MessageBox.alert(msg,{onClose:function(e){}})},error:function(e){msg="File Has been Uploaded!!";sap.m.MessageBox.alert(msg,{onClose:function(e){}})}})},onChangefixed:function(e){var t=this.getView().byId("fixed")._getSelectedItemText();if(t==="Yes"){if(owned==="X"){this.getView().byId("Repairtext").setVisible(true);this.getView().byId("Repair").setVisible(true)}else{i.confirm("Please submit request to Fleet clerk for furthur apporval.")}this.getView().byId("Towtext").setVisible(false);this.getView().byId("towvan").setVisible(false)}else if(t==="No"){if(owned==="X"){this.getView().byId("Towtext").setVisible(true);this.getView().byId("towvan").setVisible(true);this.getView().byId("Repairtext").setVisible(false);this.getView().byId("Repair").setVisible(false);this.getView().byId("Date2").setVisible(false);this.getView().byId("DP2").setVisible(false);this.getView().byId("Time2").setVisible(false);this.getView().byId("TP2").setVisible(false)}}},onChangefixed2:function(e){var t=this.getView().byId("Rescue")._getSelectedItemText();if(t==="Yes"){this.getView().byId("fixedtext").setVisible(true);this.getView().byId("fixed").setVisible(true);this.getView().byId("Date1").setVisible(true);this.getView().byId("DP1").setVisible(true);this.getView().byId("Time1").setVisible(true);this.getView().byId("TP1").setVisible(true);this.getView().byId("Towtext").setVisible(false);this.getView().byId("towvan").setVisible(false)}else if(t==="No"){this.getView().byId("Date1").setVisible(false);this.getView().byId("DP1").setVisible(false);this.getView().byId("Time1").setVisible(false);this.getView().byId("TP1").setVisible(false);this.getView().byId("Towtext").setVisible(true);this.getView().byId("towvan").setVisible(true)}},onChangefixed3:function(e){var t=this.getView().byId("towvan")._getSelectedItemText();if(t==="Yes"&&owned==="X"){this.getView().byId("Date3").setVisible(true);this.getView().byId("DP3").setVisible(true);this.getView().byId("Time3").setVisible(true);this.getView().byId("TP3").setVisible(true);this.getView().byId("Date4").setVisible(true);this.getView().byId("DP4").setVisible(true);this.getView().byId("Time4").setVisible(true);this.getView().byId("TP4").setVisible(true);this.getView().byId("Date5").setVisible(true);this.getView().byId("DP5").setVisible(true);this.getView().byId("Time5").setVisible(true);this.getView().byId("TP5").setVisible(true);this.getView().byId("Date6").setVisible(true);this.getView().byId("DP6").setVisible(true);this.getView().byId("Time6").setVisible(true);this.getView().byId("TP6").setVisible(true)}else if(t==="No"&&owned==="X"){this.getView().byId("Date3").setVisible(false);this.getView().byId("DP3").setVisible(false);this.getView().byId("Time3").setVisible(false);this.getView().byId("TP3").setVisible(false);this.getView().byId("Date4").setVisible(false);this.getView().byId("DP4").setVisible(false);this.getView().byId("Time4").setVisible(false);this.getView().byId("TP4").setVisible(false);this.getView().byId("Date5").setVisible(false);this.getView().byId("DP5").setVisible(false);this.getView().byId("Time5").setVisible(false);this.getView().byId("TP5").setVisible(false);this.getView().byId("Date6").setVisible(false);this.getView().byId("DP6").setVisible(false);this.getView().byId("Time6").setVisible(false);this.getView().byId("TP6").setVisible(false)}},onChangefixed4:function(e){var t=this.getView().byId("Repair")._getSelectedItemText();if(t==="Yes"&&owned==="X"){this.getView().byId("Date2").setVisible(true);this.getView().byId("DP2").setVisible(true);this.getView().byId("Time2").setVisible(true);this.getView().byId("TP2").setVisible(true);this.getView().byId("Reporttext").setVisible(true);this.getView().byId("Report").setVisible(true);this.getView().byId("Towtext").setVisible(false);this.getView().byId("towvan").setVisible(false);this.getView().byId("Date3").setVisible(false);this.getView().byId("DP3").setVisible(false);this.getView().byId("Time3").setVisible(false);this.getView().byId("TP3").setVisible(false)}else if(t==="No"&&owned==="X"){this.getView().byId("Date2").setVisible(false);this.getView().byId("DP2").setVisible(false);this.getView().byId("Time2").setVisible(false);this.getView().byId("TP2").setVisible(false);this.getView().byId("Towtext").setVisible(true);this.getView().byId("towvan").setVisible(true);this.getView().byId("Reporttext").setVisible(false);this.getView().byId("Report").setVisible(false)}},onChangefixed1:function(){this.getView().byId("DP1").setVisible(true);this.getView().byId("TP1").setVisible(true)}})});